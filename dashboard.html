<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang ch·ªß - Artists</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <marquee id="marqueeTxt" class="marquee-style"></marquee>
    <div class="header-bar">
        <div class="balance">Xu: <span id="userCoins">0</span> ü™ô</div>
        <button onclick="useGiftcode()" style="width:auto; padding:5px 10px;">GIFTCODE</button>
    </div>

    <div class="main-content">
        <div class="fish-icon" onclick="feedFish()">üêü</div>
        <button class="feed-btn" onclick="feedFish()">CHO C√Å ƒÇN (24H)</button>
        <div id="adminInfo" class="info-box"></div>
        <h3>üèÜ B·∫¢NG X·∫æP H·∫†NG</h3>
        <ul id="leaderboardList"></ul>
    </div>

    <script>
        const p1 = "h" + "tt" + "ps://";
        const p2 = "api" + "." + "steinhq" + ".com";
        const p3 = "/v1/storages/";
        const p4 = "699" + "eda16" + "affba40a" + "6254160c"; 
        const FULL_URL = p1 + p2 + p3 + p4 + "/Sheet1";

        let userData = JSON.parse(localStorage.getItem("currentUser"));

        async function init() {
            if (!userData) { window.location.href = "index.html"; return; }
            const res = await fetch(FULL_URL);
            const data = await res.json();
            const conf = data[0];

            document.getElementById('marqueeTxt').innerText = "TH√îNG B√ÅO: " + conf.marquee_text;
            document.getElementById('adminInfo').innerText = conf.info_box;
            document.getElementById('userCoins').innerText = userData.coins;
            window.targetCode = conf.giftcode_val;

            data.sort((a,b) => b.coins - a.coins);
            document.getElementById('leaderboardList').innerHTML = data.map(u => `<li>${u.username}: ${u.coins} Xu</li>`).join('');
        }

        async function feedFish() {
            const now = Date.now();
            if (now - (userData.last_feed || 0) < 86400000) return alert("C√° no r·ªìi!");
            const add = Math.floor(Math.random() * 3) + 1;
            await update({ coins: parseInt(userData.coins) + add, last_feed: now });
            alert(`Npc xin tr·∫£ l·ªùi: +${add} xu!`);
            location.reload();
        }

        async function useGiftcode() {
            if (userData.used_giftcode === "yes") return alert("ƒê√£ nh·∫≠n r·ªìi!");
            const code = prompt("Nh·∫≠p m√£:");
            if (code === window.targetCode) {
                alert("Ch·ªù 1s...");
                setTimeout(async () => {
                    const add = Math.floor(Math.random() * 20) + 1;
                    await update({ coins: parseInt(userData.coins) + add, used_giftcode: "yes" });
                    alert(`Npc xin tr·∫£ l·ªùi: +${add} xu!`);
                    location.reload();
                }, 1000);
            } else { alert("Sai m√£!"); }
        }

        async function update(obj) {
            await fetch(FULL_URL, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ condition: {username: userData.username}, set: obj })
            });
            localStorage.setItem("currentUser", JSON.stringify({...userData, ...obj}));
        }
        init();
    </script>
</body>
</html>
